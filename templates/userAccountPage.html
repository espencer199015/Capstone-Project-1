<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE-edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='loginSignupStyle.css') }}">

    <title>User Account</title>
</head>
<body>
    <!-- Navigation Bar -->
    <nav>
        <ul>
            <li><a href="{{ url_for('home') }}">Home</a></li>
            <li><a href="{{ url_for('lesson_page') }}">Lessons</a></li>
            {% if user %}
                <li><a href="{{ url_for('user_account_page') }}">Howdy, {{ user.username }}!</a></li>
                <li>
                    <form action="/logout" method="post">
                        <input class="logout-button" type="submit" value="Logout">
                    </form>
                </li>
            {% else %}
                <li><a href="{{ url_for('login_signup_page') }}">Login/Signup</a></li>
            {% endif %}
        </ul>
    </nav>

    <div id="account-details">
        <h1>User Account Details</h1>
        {% if user %}
            <!-- Display user information if authenticated -->
            <p>Username: {{ user.username }}</p>
            <p>Email: {{ user.email }}</p>
            <p>First Name: {{ user.first_name }}</p>
            <p>Last Name: {{ user.last_name }}</p>
            <p>Home Address: {{ user.home_address }}</p>
            <p>City/Town: {{ user.city_town }}</p>
            <p>State: {{ user.state }}</p>
            <p>Zip Code: {{ user.zip_code }}</p>
            <!-- edit button -->
            <button type="submit">EDIT</button>
        {% else %}
            <p>User not authenticated.</p>
        {% endif %}
    </div>   

    <!-- Cart Section -->
    <div id="cart-section" style="display: none;">
        <h1>Shopping Cart</h1>
        <div id="cart-items-list">
            {% for lesson in session['cart'] %}
                <p>Lesson Name: {{ lesson['lesson_name'] }}</p>
                <p>Price: ${{ lesson['lesson_price'] }}</p>
                <form action="/remove_lesson" method="post">
                    <input type="hidden" name="lesson_name" value="{{ lesson['lesson_name'] }}">
                    <button type="submit">Remove</button>
                </form>
            {% endfor %}
        </div>
<!-- Checkout Button -->
    <button id="checkout-btn">Checkout</button>
    </div>

    <button id="view-cart">View Cart</button>

    <!-- Transaction History -->
    <div id="transaction-history">
        <h1>Transaction History</h1>
        <ul id="payment-list">
            <!-- List for displaying payment details -->
        </ul>
    </div>

    <footer></footer>
    <script src="{{ url_for('static', filename='app.js') }}"></script>
    <script>
document.getElementById('checkout-btn').addEventListener('click', function() {
    fetch('/generate_invoice', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            // Add any necessary payload data for invoice generation here
            // For example, you might send user details or cart items
            // Modify this part based on your specific requirements
            // ...
        })
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(data => {
        // Process the response from the invoice generator
        // For example, display a success message or handle errors
         if (data.success) {
            // If the invoice generation was successful
            console.log('Invoice generated:', data); // Log the generated invoice details
            // Optionally, display a success message to the user
        } else {
            // If there was an error generating the invoice
            console.error('Invoice generation failed:', data.message); // Log the error message
            // Optionally, inform the user about the failure
        }
    })
    .catch(error => {
        // Handle errors if the request fails
        console.error('Error:', error);
        // Optionally, display an error message to the user
    });
});
</script>
</body>
    </html>