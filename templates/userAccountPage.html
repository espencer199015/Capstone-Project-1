<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE-edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='loginSignupStyle.css') }}">

    <title>User Account</title>
</head>
<body>
    <!-- Navigation Bar -->
    <nav>
        <ul>
            <li><a href="{{ url_for('home') }}">Home</a></li>
            <li><a href="{{ url_for('lesson_page') }}">Lessons</a></li>
            {% if user_authenticated %}
                <li><a href="{{ url_for('user_account_page') }}">Howdy, {{ current_user.username }}!</a></li>
            {% else %}
                <li><a href="{{ url_for('login_signup_page') }}">Login/Signup</a></li>
            {% endif %}
        </ul>
    </nav>

    <div id="account-details">
        <h1>User Account Details</h1>
        {% if user %}
            <!-- Display user information if authenticated -->
            <p>Username: {{ user.username }}</p>
            <p>Email: {{ user.email }}</p>
            <p>First Name: {{ user.first_name }}</p>
            <p>Last Name: {{ user.last_name }}</p>
            <p>Home Address: {{ user.home_address }}</p>
            <p>City/Town: {{ user.city_town }}</p>
            <p>State: {{ user.state }}</p>
            <p>Zip Code: {{ user.zip_code }}</p>
            <!-- Add an edit button if needed -->
            <!-- Your edit button code -->
        {% else %}
            <p>User not authenticated.</p>
        {% endif %}
    </div>   

    <!-- Cart Section -->
    <div id="cart-section" style="display: none;">
        <h1>Shopping Cart</h1>
        <div id="cart-items-list">
            {% for lesson in session['cart'] %}
                <p>Lesson Name: {{ lesson['lesson_name'] }}</p>
                <p>Price: ${{ lesson['lesson_price'] }}</p>
                <form action="/remove_lesson" method="post">
                    <input type="hidden" name="lesson_name" value="{{ lesson['lesson_name'] }}">
                    <button type="submit">Remove</button>
                </form>
            {% endfor %}
        </div>
        <button id="checkout-btn">Checkout</button>
    </div>
    <button id="view-cart">View Cart</button>

    <!-- Transaction History -->
    <div id="transaction-history">
        <h1>Transaction History</h1>
        <ul id="payment-list">
            <!-- List for displaying payment details -->
        </ul>
    </div>
    <footer></footer>
    <script src="{{ url_for('static', filename='app.js') }}"></script>
    <script>
        // Make a GET request to retrieve payments
        fetch('/get_payments')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const paymentList = document.getElementById('payment-list');

                    // Iterate through payments and display in the list
                    data.payments.payments.forEach(payment => {
                        const listItem = document.createElement('li');
                        listItem.textContent = `Payment ID: ${payment.id}, Amount: ${payment.amount_money.amount} ${payment.amount_money.currency}`;
                        paymentList.appendChild(listItem);
                    });
                } else {
                    console.error('Error fetching payments:', data.error);
                }
            })
            .catch(error => {
                console.error('Error fetching payments:', error);
            });
    </script>
</body>
</html>